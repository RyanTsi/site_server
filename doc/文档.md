# 三、系统架构设计 [徐建奇]

该部分在设计的时候主要考虑两方面的内容，一方面是用户相关的操作，一方面是文章相关的操作，剩下部分集中作为扩展内容（包括网站的信息相关和留言板相关），后续也能够随着新内容部的引入而从中分离出来。
用户模块的初衷在于让用户间能够进行互动，最初设计的时候用户仅有博主通过后端脚本进行发布文章，其他用户仅有评论和留言的权限，后续为了让该系统更加亲民，任何专业的用户都能体验完整的功能，让发布文章能够通过前端进行，于是在这部分的设计上让所有用户都具有了发布文章的权利，该个人博客也逐渐演化为了论坛的形式。当然为了与最初的方案统一，最终还是以个人博客的形式呈现，限制了仅有特定的用户能够发布文章，但为后续向论坛的形式进行改进保留了空间。

# 四、API设计 [徐建奇]

该部分在设计的时候采取了类似面向对象的方式，路由的第一级表示要操作的`对象`，第二级表示对该对象采取的`动作`。

参照`三、系统架构设计`中描述的，主要分为两类对象，用户和文章，其他零碎的部分则是仅有一级，当然随着后续功能的加入也会分离出对应的对象。

## 用户模块

包括常规的注册、注销、登陆、修改信息、查询信息操作以及发布文章、评论、留言这些特定的操作。

## 文章模块

文章模块是系统的核心部分，涵盖了创建、删除、更新、获取文章内容、获取文章信息列表、获取文章的评论列表功能。

## 扩展

扩展部分包括网站的基本信息管理（查看信息和修改信息）、留言板功能（查看留言板列表）、上传文件和静态文件访问。

> **网站信息**:
> 此功能用于获取和更新网站的基本信息，包括标题、副标题、描述、作者等内容，以及一些社交媒体的链接。

## API 表单

| 路由 | 说明 |
| --- | --- |
| `/post/create` | 创建一篇文章 |
| `/post/delete` | 删除一篇文章 |
| `/post/update` | 更新一篇文章 |
| `/post/content` | 得到文章内容 |
| `/post/infolist` | 得到文章列表 |
| `/post/remarks` | 得到文章对应的评论内容 |
| `/user/register` | 注册一名用户 |
| `/user/delete` | 注销一名用户 |
| `/user/update` | 更新用户信息 |
| `/user/login` | 用户登陆 |
| `/user/info` | 得到用户信息 |
| `/user/remark` | 用户发表评论 |
| `/user/chat` | 用户留言 |
| `/chatlist` | 留言板消息列表 |
| `/upload` | 上传文件 |
| `/resouce/{file/path}` | 静态文件访问 |
| `/basicinfo` | 获取网站信息 |
| `/updateinfo` | 更新网站信息 |

## API 使用及测试

### Base URL

http://124.223.209.159:8300/api

### Routes

#### `/post`

##### Create Post

- **Description**: 创建一篇文章
- **URL**: `/post/create`
- **Method**: POST
- **Request Body**:
```json
{
   "title": "test",
   "author": 100000,
   "brief": "广告招租位",
   "content": "test",
   "tags": ["广告", "测试"]
}
```
- **Response**:
  - **Status**: 200 OK 

##### Delete Post

- **Description**: 删除一篇文章
- **URL**: `/post/delete`
- **Method**: POST
- **Request Body**:
```json
{
  "pid": "f354c332-a2ad-42a6-bdae-99b535395ef1"
}
```
- **Response**:
  - **Status**: 200 OK / 500 Internal Server Error
  - **Error Message**:
    ```json
    "Data Not Found in database"
    ```

##### Update Post

- **Description**: 更新一篇文章
- **URL**: `/post/update`
- **Method**: POST
- **Request Body**:
```json
{
  "pid": "dfebd659-9cd2-4c9a-8a42-85fbf561bd9a",
  "title": "update",
  "brief": "广告招租位update",
  "content": "更新！！！！",
  "tags": ["广告", "测试", "更新"]
}
```
- **Response**:
  - **Status**: 200 OK

##### List Post Information

- **Description**: 得到文章列表
- **URL**: `/post/infolist`
- **Method**: GET
- **Response**:
  - **Status**: 200 OK
  - **Body**:
  ```json
    [
      {
        "author": 100000,
        "brief": "广告招租位",
        "date": "2024-06-06T13:08:27Z",
        "pid": "283036ea-afe6-46df-bbb4-f47d10172114",
        "tags": ["广告", "测试"],
        "title": "test"
      },
      ...
    ]
  ```

##### Get Post Content

- **Description**: 得到文章内容
- **URL**: `/post/content`
- **Method**: GET
- **Query Parameters**:
  - `pid`: string
- **Response**:
  - **Status**: 200 OK
  - **Body**:
  ```
    Content 内容 String
  ```

##### List Post Remarks

- **Description**: 得到文章对应的评论内容
- **URL**: `/post/remarks`
- **Method**: GET
- **Query Parameters**:
  - `pid`: string
- **Response**:
  - **Status**: 200 OK
  - **Body**:
  ```json
    [
      {
        "content": "remark",
        "created_at": "2024-06-06T13:08:27Z",
        "uid": 10000000
      },
      ...
    ]
  ```


#### `/user`

##### Register User

- **Description**: 注册一名用户
- **URL**: `/user/register`
- **Method**: POST
- **Request Body**:
```json
{
  "name": "username",
  "passwd": "password"
}
```
- **Response**:
  - **Status**: 200 OK
  - **Body**: 
   ```json
    uid
   ```

##### Delete User

- **Description**: 注销一名用户
- **URL**: `/user/delete`
- **Method**: POST
- **Request Body**:
```json
{
  "uid": 10000002
}
```
- **Response**:
  - **Status**: 200 OK
  
##### Update User

- **Description**: 更新用户信息
- **URL**: `/user/update`
- **Method**: POST
- **Request Body**:
```json
{
  "uid": 10000000,
  "passwd": "root",
  "name": "root",
  "avatar": null,
  "bio": null
}
```
- **Response**:
  - **Status**: 200 OK

##### User Login

- **Description**: 用户登陆
- **URL**: `/user/login`
- **Method**: POST
- **Request Body**:
```json
{
  "uid": 10000000,
  "passwd": "root"
}
```
- **Response**:
  - **Status**: 200 OK / 500 Internal Server Error
  - **Body**:
    - Success:
    ```json
    {
      "code": 1,
      "userinfo": {
        "avatar": null,
        "bio": null,
        "created_at": "2024-06-06T07:47:26Z",
        "name": "root",
        "uid": 10000000
      }
    }
    ```
    - Failure:
    ```json
    {
      "code": 0,
      "userinfo": null
    }
    ```
    - Error Message:
    ```
    "User Not Found
    ```

##### User Info

- **Description**: 得到用户信息
- **URL**: `/user/info`
- **Method**: GET
- **Query Parameters**:
  - `uid`: int
- **Response**:
  - **Status**: 200 OK
  - **Body**: 
  ```json
   {
    "uid": 10000000,
    "name": "root",
    "avatar": null,
    "bio": null,
    "created_at": "2024-06-06T07:47:26Z"
  }
  ```

##### Add Remark

- **Description**: 用户发表评论
- **URL**: `/user/remark`
- **Method**: POST
- **Request Body**:
```json
{
  "uid": 10000000,
  "pid": "dfebd659-9cd2-4c9a-8a42-85fbf561bd9a",
  "content": "remark"
}
```
- **Response**:
  - **Status**: 200 OK

##### Add Chat

- **Description**: 用户聊天
- **URL**: `/user/chat`
- **Method**: POST
- **Request Body**:
```json
{
  "uid": 10000000,
  "content": "chat"
}
```
- **Response**:
  - **Status**: 200 OK


#### `/chatlist`

- **Description**: 聊天消息列表
- **URL**: `/chatlist`
- **Method**: GET
- **Request Body**:
```json
{
  "uid": 10000000,
  "content": "chat"
}
```
- **Response**:
  - **Status**: 200 OK
  - **Body**:
  ```json
  [
    {
      "content": "chat",
      "created_at": "2024-06-06T12:55:05Z",
      "uid": 10000000
    },
    ...
  ]
  ```

#### Upload

- **Description**: 上传文件
- **URL**: `/upload`
- **Method**: POST
- **Request Body**:
  - Content-Type: multipart/form-data
  - Fields:
    - file: 文件内容，类型为 file，即要上传的文件。
- **Response**:
  - **Status**: 200 OK

> ps: 请传入的文件名做好唯一性区别，传入的文件内容要求小于 2MB

#### resouce

- **Description**: 静态文件访问
- **URL**: `/resouce/{file/path}`
- **Method**: GET
- **Response**:
  - **Status**: 200 OK


#### basic_info

- **Description**: 网站信息
- **URL**: `/basicinfo`
- **Method**: GET
- **Response**:
  - **Status**: 200 OK
  - **Body**:
  ```json
  {
    "sitebasicinfo": {
      "title": "",
      "subtitle": "",
      "description": "",
      "author": "",
      "favicon": "",
      "avatar": ""
    },
    "mylinks": {
      "github": "",
      "bilibili": "",
      "zhihu": "",
      "qq": "",
      "wechat": null,
      "gitee": ""
    }
  }
  ```

#### basic_info_update

- **Description**: 更新网站信息
- **URL**: `/updateinfo`
- **Method**: POST
- **Request Body**:
```json
{
  "sitebasicinfo": {
    "title": "",
    "subtitle": "",
    "description": "",
    "author": "",
    "favicon": "",
    "avatar": ""
  },
  "mylinks": {
    "github": "",
    "bilibili": "",
    "zhihu": "",
    "qq": "",
    "wechat": null,
    "gitee": ""
  }
}
```
- **Response**:
  - **Status**: 200 OK

# 五、数据库设计



### ER 图

![er图](.png)

# 七、后端服务器的实现



# 九、系统部署
# 十一、清单
# 十三、参考文献


